# 小论
- 运行效率不应该成为脚本编写的关注重点，清晰可读性才是重点
- shell脚步简单易用，linux标配，但是高端复杂的脚本的编写，使用Perl和Python会更加给力,但是缺点在于，建立它们的环境要麻烦些

# shell基础
- 设置编辑模式
    ```
    ➜  ~ set -o vi
    ```

## 管道和重定向
- 每个进程都有三个流,`stdin` `stdout` `stderr`,进程不在意这三个流来自哪里，又通向哪里，它们可能链接到一个终端，一个文件，一条网络链接，或者另一个进程的流
- 每个流的命名叫做`文件描述符`，它们依次是0,1,2
- 三个流的默认指向都是终端
- `>` `<` `>>` 是重定向，能改变流的指向
    ```
    ➜  ~ echo "this is a test message" > /tmp/mymessage /*重定向输出到文件*/
    ➜  ~ mail -s "Mail test" cky < /tmp/mymessage /*使用文件里内容发送邮件*/
    ```
- 将错误输出重定向
    ```
    ➜  ~ find / -name core /*没有重定向，stdout与stderr都输出在屏幕*/
    find: ‘/boot/efi’: 权限不够
    /dev/core
    find: ‘/sys/kernel/debug’: 权限不够
    find: ‘/var/spool/rsyslog’: 权限不够

    ➜  ~ find / -name core > /tmp/test_output /*只将stdout重定向到文件,stderr还是输出到了屏幕*/
    find: ‘/boot/efi’: 权限不够
    find: ‘/sys/kernel/debug’: 权限不够

    ➜  ~ find / -name core >& /tmp/test_output /*将stdout与stderr都输出到文件*/
    ➜  ~ cat /tmp/test_output
    find: ‘/boot/efi’: 权限不够
    /dev/core
    find: ‘/sys/kernel/debug’: 权限不够
    find: ‘/var/spool/rsyslog’: 权限不够
    find: ‘/var/spool/exim4’: 权限不够
    find: ‘/var/spool/cups’: 权限不够
    find: ‘/var/spool/cron/crontabs’: 权限不够

    ➜  ~ find / -name core 2> /tmp/null       /*将stderr输出到黑洞，将stdout输出到屏幕*/
    /dev/core
    /usr/share/atom/resources/app/apm/node_modules/git-utils/deps/libgit2/tests/core
    /usr/src/linux-headers-4.10.0-20-generic/include/config/serial/core
    /usr/src/linux-headers-4.10.0-20-generic/include/config/mlxsw/core
    /usr/src/linux-headers-4.10.0-20-generic/include/config/mlx5/core
    /usr/src/linux-headers-4.10.0-20-generic/include/config/core
    ```

- 将一条命令的stdout链接到另一条命令的stdin
    ```
    ➜  ~ ps -ef | grep ssh                
    cky       1324  1245  0 4月27 ?       00:00:00 /usr/bin/ssh-agent /usr/bin/sogou-session /usr/bin/im-launch /usr/lib/gnome-session/run-systemd-session ubuntu-session.target
    cky       1454  1183  0 4月27 ?       00:00:00 /usr/bin/gnome-keyring-daemon --start --components ssh
    cky      32116  3823  0 18:22 pts/0    00:00:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn ssh
    ➜  ~ cut -d: -f7 < /etc/passwd|sort -u
    /bin/bash
    /bin/false
    /bin/sync
    /usr/bin/zsh
    /usr/sbin/nologin
    ```
- && 与 ||
```
➜  workspace echo "hello world" > /tmp/t2
➜  workspace ls -alh && cat /tmp/t2 /*前一个命令执行成功，后面的命令才会执行*/
总用量 28K
drwxr-xr-x  7 cky cky 4.0K 4月  27 14:53 .
drwxr-xr-x 32 cky cky 4.0K 4月  28 20:27 ..
drwxr-xr-x  8 cky cky 4.0K 2月  22 22:24 blog
drwxr-xr-x  3 cky cky 4.0K 4月  27 12:07 cky
drwxr-xr-x 26 cky cky 4.0K 4月  27 21:26 linux
drwxr-xr-x  3 cky cky 4.0K 4月  20 18:59 note
drwxr-xr-x  3 cky cky 4.0K 4月  14 16:28 sudoku
hello world
➜  workspace ls -alh || cat /tmp/t2 /*前一个命令执行失败，后面的命令才会执行*/
总用量 28K
drwxr-xr-x  7 cky cky 4.0K 4月  27 14:53 .
drwxr-xr-x 32 cky cky 4.0K 4月  28 20:27 ..
drwxr-xr-x  8 cky cky 4.0K 2月  22 22:24 blog
drwxr-xr-x  3 cky cky 4.0K 4月  27 12:07 cky
drwxr-xr-x 26 cky cky 4.0K 4月  27 21:26 linux
drwxr-xr-x  3 cky cky 4.0K 4月  20 18:59 note
drwxr-xr-x  3 cky cky 4.0K 4月  14 16:28 sudoku
```

# 变量和引用
- 不要在变量两边留空白，否则shell会把变量当做命令
```
➜  ~ etcdir='/etc'
➜  ~ echo $etcdir
/etc
```
- 使用`{}`拓展变量
```
➜  ~ rev=8
➜  ~ echo "the ${rev}th version of config.conf"
the 8th version of config.conf
```

- `''`与`""`的区别 : `''`是不解析`{}` `$` `*` `?`的
    ```
    ➜  ~ myname="codekissyoung"
    ➜  ~ echo "i am ${myname}"
    i am codekissyoung
    ➜  ~ echo 'i am ${myname}'
    i am ${myname}
    ➜  ~ echo "there was `wc -l /etc/passwd` lines in passwd file" /* `` 可以被解析，它的意思是把里面的字符串执行，返回结果*/
    there was 45 /etc/passwd lines in passwd file
    ```


- 环境变量
    ```
    ➜  ~ export abc=123 /*声明一个环境变量*/
    ➜  ~ env /*输出所有环境变量*/
    XDG_SEAT_PATH=/org/freedesktop/DisplayManager/Seat0
    XDG_CONFIG_DIRS=/etc/xdg/xdg-ubuntu:/etc/xdg
    LC_TELEPHONE=zh_CN.UTF-8
    LANG=zh_CN.UTF-8
    DISPLAY=:0
    SHLVL=2
    LOGNAME=cky
    LANGUAGE=zh_CN:zh:en_US:en
    INVOCATION_ID=d1774be268ce4fcc816f39a929989c7f
    MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path
    PWD=/home/cky
    ... /*省略部分代码*/
    abc=123
    ```
用户登录终端时设置的那些环境变量都在`~/profile`和`~/.bash_profile`里，而像`PWD`这样的环境变量，由shell自动维护
